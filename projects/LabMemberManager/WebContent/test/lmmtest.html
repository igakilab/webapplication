<DOCTYPE! html>
<html>
<head>
	<title>LMMTEST</title>
	<meta charset="UTF-8">

	<script type="text/javascript" src="../dwr/engine.js"></script>
    <script type="text/javascript" src="../dwr/util.js"></script>
    <script type="text/javascript" src="../js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="../js/jquery.serialize.js"></script>
    <script type="text/javascript" src="../dwr/interface/LmmManager.js"></script>
    <script type="text/javascript" src="../js/Lmmifc.js"></script>
    <script type="text/javascript" src="../js/Lmmutil.js"></script>

    <script>
    	function act_login(){
    		var name = $("#name_input").val();
    		Lmmifc.login(name, function(rep){
    			$("#action_reply").text(rep);
    		});
    	}

    	function act_logout(){
    		var name = $("#name_input").val();
    		Lmmifc.logout(name, function(rep){
    			$("#action_reply").text(rep);
    		});
    	}


    	var MEMBER_TABLE = $("#member_state");
    	var RECORD_TABLE = $("#record_table");

    	function addMemberRow(info){
    		var nrow = $("<tr></tr>");
    		nrow.append($("<td></td>").text(info.id));
    		nrow.append($("<td></td>").text(info.stateCode));
    		nrow.append($("<td></td>").text(info.stateStr));
    		nrow.append($("<td></td>").text(info.update));
    		$("#member_state").append(nrow);
    	}

    	function addRecordRow(rec){
    		var nrow = $("<tr></tr>");
    		nrow.append($("<td></td>").text(rec.timeStamp));
    		nrow.append($("<td></td>").text(rec.id));
    		nrow.append($("<td></td>").text(rec.stateCode));
    		$("#record_table").append(nrow);
    	}

    	function updateMemberState(){
    		const labels = ["NAME", "CODE", "STATE", "UPDATE"];
    		$("#member_state").empty();
    		$("#member_state").append(Lmmutil.createLabelRow(labels));
    		Lmmifc.getRegistedId(function(member_list){
    			for(var i=0; i<member_list.length; i++){
    				Lmmifc.getMemberState(member_list[i], addMemberRow);
    			}
    		});
    	}

    	function updateRecordList(){
    		const labels = ["TIMESTAMP", "ID", "CODE"];
    		$("#record_table").empty();
    		$("#record_table").append(Lmmutil.createLabelRow(labels));
    		Lmmifc.getRecordList(function(record_list){
    			for(var i=0; i<record_list.length; i++){
    				addRecordRow(record_list[i]);
    			}
    		});
    	}


    </script>

</head>


<body>
<body>
	<h3>LabMemberManagerテストページ</h3>
	<i>Version: record-system</i>

	<hr>

	<h4>アクションを登録する</h4>
	名前: <input id="name_input" type="text"></input><br>
	<button type="button" onclick="act_login()">LOGIN</button>
	<button type="button" onclick="act_logout()">LOGOUT</button>
	<p id="action_reply"></p>

	<hr>

	<h4>メンバーの状態表示</h4>
	<button onclick="updateMemberState()">Excute1</button>
	<button onclick="updateRecordList()">Excute2</button>
	<table><tr>
		<td>
			<table id="member_state" border="1" style="width:300px">
			<tr><th>NAME</th><th>CODE</th><th>STATE</th><th>UPDATE</th>
			</table>
		</td>
		<td>
			<table id="record_table" border="1" style="width:300px">
			<tr><th>TIMESTAMP</th><th>ID</th><th>CODE</th>
			</table>
		</td>
	</tr></table>


</body>

</html>